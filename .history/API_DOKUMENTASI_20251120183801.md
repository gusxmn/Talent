# üì° API PROVINSI & KABUPATEN - DOKUMENTASI

## Overview
API ini menyediakan endpoint untuk mengambil data Provinsi dan Kabupaten dari database. Data dapat digunakan untuk populate dropdown, filter, atau kebutuhan integrasi lainnya.

---

## üîó Endpoints

### 1. **Ambil Semua Provinsi**
```
GET /admin/reference/provinsi/api/list
```

**Response (Success):**
```json
{
    "success": true,
    "data": [
        {
            "id": 1,
            "kode_provinsi": "11",
            "nama_provinsi": "Aceh",
            "status": true
        },
        {
            "id": 2,
            "kode_provinsi": "12",
            "nama_provinsi": "Sumatera Utara",
            "status": true
        }
    ]
}
```

**Fields:**
- `id` - ID Provinsi (integer)
- `kode_provinsi` - Kode Provinsi (string, misal: "11")
- `nama_provinsi` - Nama Provinsi (string)
- `status` - Status Aktif/Nonaktif (boolean)

---

### 2. **Ambil Semua Kabupaten**
```
GET /admin/reference/kabupaten/api/list
```

**Response (Success):**
```json
{
    "success": true,
    "data": [
        {
            "id": 1,
            "kode_kabupaten": "1101",
            "nama_kabupaten": "Aceh Barat",
            "jenis": "Kabupaten",
            "provinsi_id": 1
        },
        {
            "id": 2,
            "kode_kabupaten": "1102",
            "nama_kabupaten": "Aceh Besar",
            "jenis": "Kabupaten",
            "provinsi_id": 1
        }
    ]
}
```

**Fields:**
- `id` - ID Kabupaten (integer)
- `kode_kabupaten` - Kode Kabupaten (string)
- `nama_kabupaten` - Nama Kabupaten (string)
- `jenis` - Jenis (Kabupaten/Kota)
- `provinsi_id` - ID Provinsi (integer)

---

### 3. **Ambil Kabupaten by Provinsi**
```
GET /admin/reference/kabupaten/api/provinsi/{provinsiId}
```

**Parameters:**
- `provinsiId` - ID Provinsi (required)

**Response (Success):**
```json
{
    "success": true,
    "data": [
        {
            "id": 1,
            "kode_kabupaten": "1101",
            "nama_kabupaten": "Aceh Barat",
            "jenis": "Kabupaten"
        }
    ]
}
```

**Example:**
```
GET /admin/reference/kabupaten/api/provinsi/1
```

---

## üíª Contoh Implementasi

### **Contoh 1: Populate Dropdown Provinsi**

**HTML:**
```html
<select id="provinsiSelect" class="form-control">
    <option value="">-- Pilih Provinsi --</option>
</select>
```

**JavaScript:**
```javascript
async function loadProvinsi() {
    const response = await fetch('/admin/reference/provinsi/api/list');
    const data = await response.json();
    
    if (data.success) {
        const select = document.getElementById('provinsiSelect');
        data.data.forEach(provinsi => {
            const option = document.createElement('option');
            option.value = provinsi.id;
            option.textContent = `${provinsi.kode_provinsi} - ${provinsi.nama_provinsi}`;
            select.appendChild(option);
        });
    }
}

// Load saat halaman siap
document.addEventListener('DOMContentLoaded', loadProvinsi);
```

---

### **Contoh 2: Dynamic Kabupaten Dropdown (Dependent Dropdown)**

**HTML:**
```html
<select id="provinsiSelect" class="form-control"></select>
<select id="kabupatenSelect" class="form-control"></select>
```

**JavaScript:**
```javascript
async function setupDependentDropdowns() {
    const provinsiSelect = document.getElementById('provinsiSelect');
    const kabupatenSelect = document.getElementById('kabupatenSelect');
    
    // 1. Load Provinsi
    const resProvinsi = await fetch('/admin/reference/provinsi/api/list');
    const dataProvinsi = await resProvinsi.json();
    
    dataProvinsi.data.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = p.nama_provinsi;
        provinsiSelect.appendChild(option);
    });
    
    // 2. Update Kabupaten saat Provinsi berubah
    provinsiSelect.addEventListener('change', async function() {
        const provinsiId = this.value;
        kabupatenSelect.innerHTML = '<option value="">-- Pilih Kabupaten --</option>';
        
        if (provinsiId) {
            const resKabupaten = await fetch(
                `/admin/reference/kabupaten/api/provinsi/${provinsiId}`
            );
            const dataKabupaten = await resKabupaten.json();
            
            dataKabupaten.data.forEach(k => {
                const option = document.createElement('option');
                option.value = k.id;
                option.textContent = `${k.nama_kabupaten} (${k.jenis})`;
                kabupatenSelect.appendChild(option);
            });
        }
    });
}

document.addEventListener('DOMContentLoaded', setupDependentDropdowns);
```

---

### **Contoh 3: Filter & Search**

```javascript
async function searchProvinsi(keyword) {
    const response = await fetch('/admin/reference/provinsi/api/list');
    const data = await response.json();
    
    const hasil = data.data.filter(p => 
        p.nama_provinsi.toLowerCase().includes(keyword.toLowerCase())
    );
    
    return hasil;
}

// Penggunaan
searchProvinsi('aceh').then(hasil => console.log(hasil));
```

---

### **Contoh 4: Populate Table**

```javascript
async function buildProvinsitable(containerId) {
    const response = await fetch('/admin/reference/provinsi/api/list');
    const data = await response.json();
    
    let html = '<table class="table"><thead><tr><th>No</th><th>Kode</th><th>Nama</th><th>Status</th></tr></thead><tbody>';
    
    data.data.forEach((p, i) => {
        const badge = p.status ? '<span class="badge bg-success">Aktif</span>' : '<span class="badge bg-danger">Nonaktif</span>';
        html += `<tr><td>${i+1}</td><td>${p.kode_provinsi}</td><td>${p.nama_provinsi}</td><td>${badge}</td></tr>`;
    });
    
    html += '</tbody></table>';
    document.getElementById(containerId).innerHTML = html;
}

buildProvinsitable('myContainer');
```

---

## üéØ Panduan Integrasi

### **Di dalam Blade Template:**

```html
@section('content')
<div class="container">
    <div class="row">
        <div class="col-md-6">
            <label>Provinsi</label>
            <select id="provinsi" class="form-control" required>
                <option value="">-- Pilih --</option>
            </select>
        </div>
        <div class="col-md-6">
            <label>Kabupaten</label>
            <select id="kabupaten" class="form-control" required>
                <option value="">-- Pilih --</option>
            </select>
        </div>
    </div>
</div>

<script src="{{ asset('js/api-provinsi-kabupaten.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        populateProvinsiDropdown('provinsi');
        populateKabupatenDropdown('provinsi', 'kabupaten');
    });
</script>
@endsection
```

---

## üîí Keamanan

- Semua endpoint memerlukan autentikasi (`middleware(['auth', 'admin'])`)
- Hanya mengembalikan data dengan `status = true` (aktif)
- CSRF protection (jika POST/PUT/DELETE)

---

## üìã Testing

Akses halaman test di: **`/admin/api-test`**

Halaman ini memiliki:
- ‚úÖ Button untuk test semua endpoint
- ‚úÖ Live table preview
- ‚úÖ Response JSON display
- ‚úÖ Dropdown filter testing

---

## üêõ Error Handling

```javascript
async function fetchData(url) {
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        const data = await response.json();
        if (!data.success) {
            throw new Error(data.message);
        }
        return data.data;
    } catch (error) {
        console.error('Error:', error.message);
        // Handle error (show toast, alert, etc)
    }
}
```

---

## üìÅ File Referensi

- **JavaScript Library**: `/public/js/api-provinsi-kabupaten.js`
- **Test Page**: `/admin/api-test`
- **Controllers**: 
  - `app/Http/Controllers/Admin/ProvinsiController.php`
  - `app/Http/Controllers/Admin/KabupatenController.php`
- **Routes**: `routes/web.php` (lines 293-330)

---

## üìû Support

Jika ada pertanyaan atau issue, silakan check:
1. Browser console untuk error messages
2. Network tab untuk melihat response API
3. Test page di `/admin/api-test`
